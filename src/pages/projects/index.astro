---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { projects } from '../../data/projects';
import SplitText from '../../components/SplitText';
import FadeContent from '../../components/FadeContent';
import ProjectCard from '../../components/ProjectCard';
---

<BaseLayout title="项目 — 限制解除！" description="个人项目展示">
  <div class="mb-8">
    <SplitText
      client:visible
      text="项目展示"
      tag="h1"
      splitType="chars"
      delay={40}
      duration={0.8}
      ease="power3.out"
      textAlign="left"
      className="text-3xl font-bold font-tech"
    />
    <p class="mt-3 text-muted-foreground" data-i18n="projects.subtitle">一些值得分享的项目和作品。</p>
  </div>

  <div class="grid gap-6 md:grid-cols-2">
    {projects.map((project, i) => (
      <FadeContent client:visible delay={i * 100} duration={600} blur={true}>
        <div
          class="h-full"
          data-project={project.id}
          data-title={JSON.stringify(project.title)}
          data-desc={JSON.stringify(project.description)}
        >
          <ProjectCard
            client:visible
            title={project.title.zh}
            description={project.description.zh}
            tags={project.tags}
            github={project.github}
            demo={project.demo}
            media={project.media}
          />
        </div>
      </FadeContent>
    ))}
  </div>
</BaseLayout>

<script>
  import { getLocale, type Locale } from '../../lib/i18n';

  function applyProjectI18n(locale: Locale) {
    document.querySelectorAll<HTMLElement>('[data-project]').forEach((wrapper) => {
      const titleMap = JSON.parse(wrapper.dataset.title || '{}');
      const descMap = JSON.parse(wrapper.dataset.desc || '{}');

      const titleEl = wrapper.querySelector('h3');
      const descEl = wrapper.querySelector('p.line-clamp-3');

      if (titleEl && titleMap[locale]) titleEl.textContent = titleMap[locale];
      if (descEl && descMap[locale]) descEl.textContent = descMap[locale];
    });
  }

  const locale = getLocale();
  if (locale !== 'zh') applyProjectI18n(locale);

  window.addEventListener('locale-changed', (e) => {
    applyProjectI18n((e as CustomEvent).detail);
  });
</script>
