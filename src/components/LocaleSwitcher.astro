---
import { LOCALES, LOCALE_LABELS } from '../lib/i18n';
---

<div class="locale-switcher flex items-center gap-0.5">
  {LOCALES.map((locale) => (
    <button
      data-locale={locale}
      class="locale-btn px-1.5 py-0.5 text-[10px] font-tech rounded cursor-pointer transition-colors"
      {...(locale === 'zh' ? { 'data-active': '' } : {})}
    >
      {LOCALE_LABELS[locale]}
    </button>
  ))}
</div>

<style>
  .locale-btn {
    color: var(--color-muted-foreground);
  }
  .locale-btn:hover {
    color: var(--color-foreground);
  }
  .locale-btn[data-active] {
    color: var(--color-primary);
    background-color: color-mix(in srgb, var(--color-primary) 12%, transparent);
  }
</style>

<script>
  import { getLocale, setLocale, type Locale } from '../lib/i18n';

  const allBtns = document.querySelectorAll<HTMLButtonElement>('.locale-btn');

  // Init: highlight stored locale across all instances
  const current = getLocale();
  allBtns.forEach((btn) => {
    if (btn.dataset.locale === current) {
      btn.setAttribute('data-active', '');
    } else {
      btn.removeAttribute('data-active');
    }
  });

  // Click handler â€” sync active state across all instances
  allBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const locale = btn.dataset.locale as Locale;
      allBtns.forEach((b) => {
        if (b.dataset.locale === locale) {
          b.setAttribute('data-active', '');
        } else {
          b.removeAttribute('data-active');
        }
      });
      setLocale(locale);
    });
  });
</script>
