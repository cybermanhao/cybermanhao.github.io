---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';
import SplitText from './SplitText';
import { Badge } from './ui/badge';

interface Props {
  title: string;
  pubDate: Date;
  updatedDate?: Date;
  tags: string[];
  body?: string;
  cover?: ImageMetadata | string;
}

const { title, pubDate, updatedDate, tags, body = '', cover } = Astro.props;
const isLocalImage = cover && typeof cover !== 'string';

const charCount = body.length;
const readingTime = Math.max(1, Math.ceil(charCount / 600));
---

<header class="mb-10 not-prose">
  {cover && (
    <div class="mb-6 -mx-2 md:-mx-4 rounded-xl overflow-hidden">
      {isLocalImage ? (
        <Image
          src={cover as ImageMetadata}
          alt={title}
          widths={[600, 900, 1200]}
          sizes="(max-width: 768px) 100vw, 720px"
          class="w-full aspect-video object-cover object-[center_20%]"
        />
      ) : (
        <img
          src={cover as string}
          alt={title}
          class="w-full aspect-video object-cover object-[center_20%]"
        />
      )}
    </div>
  )}

  <div class="mb-4">
    <SplitText
      client:visible
      text={title}
      tag="h1"
      splitType="chars"
      delay={30}
      duration={0.8}
      ease="power3.out"
      fromJson='{"opacity":0,"y":30}'
      toJson='{"opacity":1,"y":0}'
      textAlign="left"
      className="text-3xl md:text-4xl font-bold font-tech"
    />
  </div>

  <div class="flex items-center gap-3 text-sm text-muted-foreground flex-wrap">
    <time datetime={pubDate.toISOString()}>
      {pubDate.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })}
    </time>
    {updatedDate && (
      <>
        <span class="text-border">·</span>
        <span>
          更新于 <time datetime={updatedDate.toISOString()}>
            {updatedDate.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })}
          </time>
        </span>
      </>
    )}
    <span class="text-border">|</span>
    <span>{readingTime} 分钟阅读</span>
  </div>

  {tags.length > 0 && (
    <div class="mt-4 flex flex-wrap gap-2">
      {tags.map((tag: string) => (
        <a href={`/blog?tag=${encodeURIComponent(tag)}`}>
          <Badge variant="outline" className="hover:bg-primary/10 hover:border-primary/50 transition-colors cursor-pointer font-tech text-xs">
            #{tag}
          </Badge>
        </a>
      ))}
    </div>
  )}
</header>
